import unittest
from MalwareDetection import MalwareDetection, EXIT_CODES

TestURL = MalwareDetection()

class TesMaliciousURLMethods(unittest.TestCase):
    def test_url(self):
        print "Test Invalid APK file"
        url_1 = 'https://download.apkpure.com/custom/com.apkpure.aegon-891.apk?_fn=QVBLUHVyZV92MS40LjFfYXBrcHVyZS5jb20uYXBr&k=8d98ff6f480bb2287857038dfdf164e458f8f26b&as=411b70aaea1345e7abb388fa6ad13f5058f64fe3&_p=Y29tLmFwa3B1cmUuYWVnb24%3D&c=1%7CTOOLS&arg=apkpure%3A%2F%2Fcampaign%2F%3Futm_source%3Dapkpure%26utm_medium%3Dhttps%3A%2F%2Fapkpure.com%2Fapkpure%2Fcom.apkpure.aegon%26utm_term%3Da4d'
        self.assertEqual(TestURL.isMalware(url_1), EXIT_CODES.index('NotValid'))
        print "Test Malware APK file"
        url_3 = 'http://shouji.360tpcdn.com/160622/96f7b4b431751bd9017e3be62d7b8919/sll.zhuishushenqi.mf_3.apk'
        self.assertEqual(TestURL.isMalware(url_3), EXIT_CODES.index('isMalware'))
        url_4 = 'http://down.360safe.com/yunpan/360mall_360yunpan_1.apk'
        self.assertEqual(TestURL.isMalware(url_4), EXIT_CODES.index('isMalware'))
        url_5 = 'http://down.360safe.com/yunpan/360mall_360yunpan_1.apk?channel_id=foo&timestamp=bar'
        self.assertEqual(TestURL.isMalware(url_5), EXIT_CODES.index('isMalware'))
        print "Test Malware APK files with same md5 but different name, url"
        url_6 = 'http://app.sadl.sogou.com/apks/sogousearch_1303b.apk'
        self.assertEqual(TestURL.isMalware(url_6), EXIT_CODES.index('isMalware'))
        url_7 = 'http://dl.appsearch.m.sogou.com/apks/sogousearch_8010.apk'
        self.assertEqual(TestURL.isMalware(url_7), EXIT_CODES.index('isMalware'))

if __name__ == '__main__':
    unittest.main()
