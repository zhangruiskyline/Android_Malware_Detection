

API_KEY = 'a7ceb212f39d6a547859c65eb42b4ebacf48f90ea024ed71e5470b47f4688e31'
url = 'http://pollux.androidapksfree.com/hdata/ba138e619e62d5dab879d234b10caf5a/devian.tubemate.home_v2.3.8-707_Android-2.1.apk'


import json
import hashlib
from virus_total_apis import PublicApi as VirusTotalPublicApi


vt_instance = VirusTotalPublicApi(API_KEY)

response =  vt_instance.get_url_report(url)
#print json.dumps(response, sort_keys=False, indent=4)

if "positives" in response["results"] and response["results"]["positives"] == 0:
    print "No Error"
else:
    print "Malware"


from UrlDB import MaliciousURL,checkUrlRecord,checkMD5Record,checkNameandSizeRecord,insertAPK
from apk_download import APK_Download
from apk_parse.apk import APK

download_apk = APK_Download(url)
if download_apk is None:
    pass
else:
    apk_file = APK(download_apk)
    if checkNameandSizeRecord(apk_file.filename,apk_file.file_size) is False:
        insertAPK(apk_file.file_md5,apk_file.filename,apk_file.file_size,url)
        print "insert to DB"
    else:
        print "url exist"

