# Setup

* Python 2.7.12 |Anaconda 4.2.0 (x86_64)

# Requirements:

> class called MalwareDetection, which exposes a method isMalware(url) that returns an integer return code; 
Based on the return code it tells whether the url link indicated by the ‘url’ parameter pointing something malicious.

# Design

## Business Logic
* Look up in a local  DB to see whether it has any exact match of the url link(remove query). 
If it does, return the truth from the DB match;
* If it doesn’t find an exact match of the url from step 1, but find an exact match on the name of the APK (case insensitive), 
fetch the metadata (the size of the APK file to be downloaded) from the url. If the size matches the one in DB, return the truth from the DB match;
* If the size from step 2 doesn’t match, neither APK name matches, download the APK file from the url to local dir. 
If successfully downloaded, calculate the MD5 hash from the APK file and look up the hash in DB. Return truth from DB if a hash matches can be found in DB.
* If it can’t find a hash match from step 3, call Virus Total API to scan the file. Save the scan result to DB if virus detected and return the scan result.
  
## DB Schema

* SQLite
* One Table named as MaliciousURLs.
* Four Columns:
```
Column('id',Integer, primary_key=True),
    Column('apk_md5',String), #md5 Hash of APK file
    Column('apk_name',String),
    Column('apk_size',Integer),
    Column('apk_url', String,  unique=True)
```


## File Architecture

* MalwareDetection.py is the main file that contains Class MalwareDetection()

* apk_download.py is to download apk from url link

* apk_parse/ folder is used to parse downloaded apk file

* UrlDB.py is the SQLite database file

* test.py is the unit test file based on Python unit test framework. virustotal_test.py is mannual test case


## Return status

['isMalware','isClean','NotValid','DB_no_connection','VirusTotal_no_connection','File_too_large']

* isMalware: APK URL has malicious file
* isClean: APK URL is clean
* NotValid: url link dose not contain apk file
* DB_no_connection: Database is not available 
* VirusTotal_no_connection: API call to http://virustotal.com/ dose not respond correctly
* File_too_large: File size exceeds API limitation of 32M

## Misc

* Run time could be slow as there is possible file download, and API calls has limitation of max 4 calls per min for free use. 
* File size larger than 32M will not be processed 

# Run Application

* Run the UrlDB.py first to create the database


 